#
# Copyright (c) 2022 Wind River Systems, Inc.
#
# SPDX-License-Identifier: Apache-2.0
#

image: docker.io/starlingx/dex
imageTag: stx.4.0-v2.14.0-1
env:
  - name: KUBERNETES_POD_NAMESPACE
    valueFrom:
      fieldRef:
        fieldPath: metadata.namespace
config:
  enablePasswordDB: false
  web:
    https: 0.0.0.0:5556
    tlsCert: /etc/dex/tls/https/server/tls.crt
    tlsKey: /etc/dex/tls/https/server/tls.key
service:
  type: NodePort
nodeSelector:
  node-role.kubernetes.io/master: ""
certs:
  web:
    create: false
    secret:
      tlsName: local-dex.tls
      caName: local-dex.tls
  grpc:
    create: false
    secret:
      serverTlsName: local-dex.tls
      clientTlsName: local-dex.tls
      caName: local-dex.tls
tolerations:
- key: "node-role.kubernetes.io/master"
  operator: "Exists"
  effect: "NoSchedule"
affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
    - labelSelector:
        matchExpressions:
        - key: app
          operator: In
          values:
          - dex
      topologyKey: kubernetes.io/hostname
helmv3Compatible: true
